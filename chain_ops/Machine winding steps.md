# Machine winding steps

## Method 1: Binding via web wallet定

### 0. Preparation

+ Before binding, please make sure you have enough balance in your wallet. (Each card is estimated to be 100,000 DBC).
+ Open the settings page of the web wallet：`https://www.dbcwallet.io/?rpc=wss%3A%2F%2Finnertest.dbcwallet.io#/settings/developer`

+ Open `https://github.com/DeepBrainChain/DeepBrainChain-MainChain/blob/feature/staking_v3.0.0_online_profile/types.json`, copy the content of `types.json`, and paste it to the web wallet settings page, click save .

  ![](bonding_machine.assets/火狐截图_2021-06-01T08-25-33.414Z.png)

+ Refresh the page and wait a while.

### 1. Capital account binding control account

+ Description:

  +  The fund account is built into the machine. When the machine is bound, the DBC will be pledged from the fund account, and it will be issued to the fund account when the reward is distributed.
  + The control account is the manager who is responsible for the operation of the machine, maintenance, etc.
  + The fund account must specify a control account.
  + The control account must have a small amount of DBC, and the handling fee generated by the chain operation will be deducted from the control account.

+ Navigate to: `Developer`--`Transaction`, as shown below, select the `setController` method of the `onlineProfile` module, select the fund account and control account respectively, and click bind in the lower right corner

  ![image-20210621162810500](bonding_machine.assets/image-20210621162810500.png)
### 2. Go online

	Navigate to: `Developer`--`Transaction`, and select the `bondMachine` method of the `onlineProfile` module as shown below. To use the control account, bind the MachineId to the control account.

![image-20210621164107038](bonding_machine.assets/image-20210621164107038.png)

### 3. Machine-generated signature information

> Note: Since the DBC program has not updated the machine ID to a wallet-like format, please go to the node_private_key= of /home/dbc/0.3.7.3/dbc_repo/dat/node.dat for the private key corresponding to the test machine ID.

+ E.g,

  + The machine ID is `5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty`
  + The private key corresponding to the machine ID is: `0x398f0c28f98885e046333d4a41c19cee4c37368a9832c6502f6cfd182e2aef89`
  + The fund account is `5HpG9w8EBLe5XCrbczpwq5TSXvedjrBGCwqxK1iQ7qUsSWFc`

  The method to generate a signature is (web tools will be provided in the future):

  ```bash
  # Note: Please install node.js v14 and yarn by yourself
  git clone https://github.com/DeepBrainChain/DeepBrainChain-MainChain.git
  cd DeepBrainChain-MainChain && git checkout feature/staking_v3.0.0_online_profile && cd scripts/test_script
  yarn
  
  node gen_signature.js --key 0x398f0c28f98885e046333d4a41c19cee4c37368a9832c6502f6cfd182e2aef89 --msg "5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty5HpG9w8EBLe5XCrbczpwq5TSXvedjrBGCwqxK1iQ7qUsSWFc"
  ```

Generate results:

```
### MSG: 5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty5HpG9w8EBLe5XCrbczpwq5TSXvedjrBGCwqxK1iQ7qUsSWFc
### SignedBy: 5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty
### Signature: 0xa2dac9014f46b2190aefcac4ede674fdfff06564f7644dd8fa96d9748e3a53329fc5c028651a756e5e287927ea0d20fafb3fa8264dd8be46108b26a387915182
```

Among them, Signature is the signature information

### 4. The machine submits the signature information and binds the fund account

+ Note: We need the machine signature to confirm the capital account corresponding to the machine

+ Navigate to: `Developer`--`Transaction`, select the `machineSetStash` method of the `onlineProfile` module as shown below, fill in the parameters, and submit the transaction.

+ Among them, the msg parameter, fill in the string formed by the [machine IDStash account]; the sig parameter fill in the result of signing the string with the machine's private key.

  ![image-20210622151757950](bonding_machine.assets/image-20210622151757950.png)





### 5. Check and receive rewards

#### 1. Check rewards

In the developer-chain status, select: the `stashMachines` method of the `onlineProfile` module, fill in the **stash** account (not the control account) as the parameters, and you will be able to check the detailed information of the stash account to receive rewards.

Among them, `can_claim_reward` is the reward that can be claimed, and `left_reard` is the remaining part of the reward obtained every day before (the remaining 75%, this 75% will be released in the subsequent 150 antennas).

![image-20210623143656481](bonding_machine.assets/image-20210623143656481.png)

#### 2. Collect rewards

Use **Control Account** to receive it, and the reward will be issued to the stash account.

![image-20210623144049700](bonding_machine.assets/image-20210623144049700.png)

## Method 2: add via script

```bash
git clone https://github.com/DeepBrainChain/DeepBrainChain-MainChain.git
cd DeepBrainChain-MainChain && git checkout feature/staking_v3.0.0_online_profile && cd scripts/test_script
yarn

ws="wss://innertest.dbcwallet.io"
tf="../../dbc_types.json"
rpc="../../dbc_rpc.json"
bob_stash_key="0x1a7d114100653850c65edecda8a9b2b4dd65d900edef8e70b1a6ecdcda967056"
bob="5FHneW46xGXgs5mUiveU4sbTyGBzmstUspZC92UhjJM694ty"
dave="5DAAnrj7VHTznn2AWBemMuyBwZWs6FNFjdyVXUeYum3PTXFy"
dave_key="0x868020ae0687dda7d57565093a69090211449845a7e11453612800b663307246"

# stash account settings control account. The control account is: Dave; the machine ID is Bob; the machine stash account is BobStash:
node tx_by_user.js --port $ws --type-file $tf --rpc-file $rpc --module onlineProfile --func setController \
    --key $bob_stash_key $dave

# Bind the machine: dave is the controller, and a machine is bound: Bob, and the beneficiary account is BobStash
node tx_by_user.js --port $ws --type-file $tf --rpc-file $rpc --module onlineProfile --func bondMachine \
    --key $dave_key $bob
```